<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToneScope - Audio Analysis & Mastering Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata@2.2.3/dist/chartjs-plugin-dragdata.min.js"></script>
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ ToneScope</h1>
            <p class="subtitle">Professional Audio Analysis & Mastering Tool for Music Producers</p>
        </header>

        <div class="upload-section">
            <h2>Upload Audio Files</h2>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <p>Drag & drop audio files here or click to browse</p>
                <input type="file" id="fileInput" multiple accept=".wav,.mp3,.flac,.aiff,.ogg,.m4a" style="display: none;">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Select Files</button>
            </div>
            <div id="fileList" class="file-list"></div>
            <div class="action-buttons">
                <button class="btn btn-success" id="analyzeBtn" disabled>Analyze Tracks</button>
                <button class="btn btn-danger" id="clearBtn">Clear All Files</button>
            </div>
        </div>

        <div id="analysisResults" style="display: none;">
            <div class="module-section">
                <h2>Module 1: Analyzer</h2>
                
                <div class="analysis-panel">
                    <h3>Tonal Balance - Frequency Spectrum</h3>
                    <p class="description">Overlaid frequency spectrum of all tracks showing tonal balance across the album</p>
                    <canvas id="frequencyChart"></canvas>
                </div>

                <div class="analysis-panel">
                    <h3>Dynamic Range Analysis</h3>
                    <p class="description">LUFS, True Peak, and Crest Factor measurements for each track</p>
                    <div class="table-container">
                        <table id="dynamicRangeTable">
                            <thead>
                                <tr>
                                    <th>Track</th>
                                    <th>LUFS</th>
                                    <th>True Peak (dB)</th>
                                    <th>Crest Factor (dB)</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="analysis-panel">
                    <h3>Stereo Image Analysis</h3>
                    <p class="description">Stereo width and correlation analysis for each track</p>
                    <div class="stereo-grid" id="stereoGrid"></div>
                </div>
            </div>

            <div class="module-section">
                <h2>Module 2: Tonal Palette</h2>
                
                <div class="analysis-panel">
                    <h3>Select Track for Processing</h3>
                    <select id="trackSelector" class="track-selector">
                        <option value="">Choose a track...</option>
                    </select>
                </div>

                <div class="analysis-panel">
                    <h3>One-Click Tonal Presets</h3>
                    <p class="description">Select a mastering preset for processing</p>
                    <div class="effect-toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="tonalPresetToggle">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Enable Tonal Preset</span>
                        </label>
                    </div>
                    <div class="preset-buttons" id="presetButtons" style="margin-top: 10px;">
                        <label class="preset-radio">
                            <input type="radio" name="preset" value="brighter">
                            <span>‚ú® Brighter</span>
                        </label>
                        <label class="preset-radio">
                            <input type="radio" name="preset" value="darker">
                            <span>üåô Darker</span>
                        </label>
                        <label class="preset-radio">
                            <input type="radio" name="preset" value="vintage_warmth">
                            <span>üî• Vintage Warmth</span>
                        </label>
                        <label class="preset-radio">
                            <input type="radio" name="preset" value="modern_punch">
                            <span>‚ö° Modern Punch</span>
                        </label>
                    </div>
                </div>

                <div class="analysis-panel">
                    <h3>Custom EQ</h3>
                    <p class="description">Create your own EQ curve for processing</p>
                    <div class="effect-toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="customEqToggle">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Enable Custom EQ</span>
                        </label>
                    </div>
                    <canvas id="customEqChart"></canvas>
                    <div class="custom-eq-controls">
                        <input type="text" id="customPresetName" placeholder="Preset Name">
                        <button class="btn btn-success" id="saveCustomPresetBtn">Save Preset</button>
                    </div>
                </div>

                <div class="analysis-panel">
                    <h3>Reference Matching</h3>
                    <p class="description">Upload a reference track to apply its EQ curve to your selected track</p>
                    <div class="reference-upload">
                        <input type="file" id="referenceInput" accept=".wav,.mp3,.flac,.aiff,.ogg,.m4a" style="display: none;">
                        <button class="btn btn-secondary" onclick="document.getElementById('referenceInput').click()">Upload Reference Track</button>
                        <button class="btn btn-success" id="matchBtn" disabled>Apply Reference EQ</button>
                    </div>
                    <div id="referenceInfo"></div>
                </div>

                <div class="analysis-panel" id="waveformPanel" style="display: none;">
                    <h3>Waveform & Playback</h3>
                    <div id="waveform"></div>
                    <div class="playback-controls">
                        <button class="btn btn-play" id="playBtn">‚ñ∂Ô∏è Play</button>
                        <button class="btn btn-play" id="pauseBtn">‚è∏Ô∏è Pause</button>
                        <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                    </div>
                </div>

                <div id="processedFiles" class="processed-files"></div>
            </div>
        </div>

        <div class="module-section">
            <h2>Module 3: Advanced Processing</h2>

            <div class="analysis-panel">
                <h3>Multi-band Compressor</h3>
                <p class="description">Apply dynamic compression to different frequency bands.</p>
                <div class="multiband-compressor-controls">
                    <div class="band-controls">
                        <h4>Low Band</h4>
                        <div class="control-group">
                            <label>Threshold (dB)</label>
                            <input type="range" id="low-threshold" min="-60" max="0" value="-20" step="1">
                            <span id="low-threshold-value">-20 dB</span>
                        </div>
                        <div class="control-group">
                            <label>Ratio</label>
                            <input type="range" id="low-ratio" min="1" max="20" value="2" step="0.1">
                            <span id="low-ratio-value">2:1</span>
                        </div>
                        <div class="control-group">
                            <label>Attack (ms)</label>
                            <input type="range" id="low-attack" min="1" max="100" value="10" step="1">
                            <span id="low-attack-value">10 ms</span>
                        </div>
                        <div class="control-group">
                            <label>Release (ms)</label>
                            <input type="range" id="low-release" min="10" max="1000" value="100" step="10">
                            <span id="low-release-value">100 ms</span>
                        </div>
                    </div>
                    <div class="band-controls">
                        <h4>Mid Band</h4>
                        <div class="control-group">
                            <label>Threshold (dB)</label>
                            <input type="range" id="mid-threshold" min="-60" max="0" value="-20" step="1">
                            <span id="mid-threshold-value">-20 dB</span>
                        </div>
                        <div class="control-group">
                            <label>Ratio</label>
                            <input type="range" id="mid-ratio" min="1" max="20" value="2" step="0.1">
                            <span id="mid-ratio-value">2:1</span>
                        </div>
                        <div class="control-group">
                            <label>Attack (ms)</label>
                            <input type="range" id="mid-attack" min="1" max="100" value="10" step="1">
                            <span id="mid-attack-value">10 ms</span>
                        </div>
                        <div class="control-group">
                            <label>Release (ms)</label>
                            <input type="range" id="mid-release" min="10" max="1000" value="100" step="10">
                            <span id="mid-release-value">100 ms</span>
                        </div>
                    </div>
                    <div class="band-controls">
                        <h4>High Band</h4>
                        <div class="control-group">
                            <label>Threshold (dB)</label>
                            <input type="range" id="high-threshold" min="-60" max="0" value="-20" step="1">
                            <span id="high-threshold-value">-20 dB</span>
                        </div>
                        <div class="control-group">
                            <label>Ratio</label>
                            <input type="range" id="high-ratio" min="1" max="20" value="2" step="0.1">
                            <span id="high-ratio-value">2:1</span>
                        </div>
                        <div class="control-group">
                            <label>Attack (ms)</label>
                            <input type="range" id="high-attack" min="1" max="100" value="10" step="1">
                            <span id="high-attack-value">10 ms</span>
                        </div>
                        <div class="control-group">
                            <label>Release (ms)</label>
                            <input type="range" id="high-release" min="10" max="1000" value="100" step="10">
                            <span id="high-release-value">100 ms</span>
                        </div>
                    </div>
                </div>
                <div class="effect-toggle-container">
                    <label class="toggle-switch">
                        <input type="checkbox" id="multibandCompressorToggle">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Enable Multi-band Compressor</span>
                    </label>
                    <button class="btn btn-secondary" id="autoTuneCompressorBtn" style="margin-left: 20px;">Auto-Tune Settings</button>
                </div>
            </div>

            <div class="analysis-panel">
                <h3>Stereo Imaging</h3>
                <p class="description">Adjust the stereo width of the selected track.</p>
                <div class="stereo-imaging-controls">
                    <div class="control-group">
                        <label>Width</label>
                        <input type="range" id="stereo-width" min="0" max="2" value="1" step="0.1">
                        <span id="stereo-width-value">1.0</span>
                    </div>
                </div>
                <div class="effect-toggle-container">
                    <label class="toggle-switch">
                        <input type="checkbox" id="stereoImagingToggle">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Enable Stereo Imaging</span>
                    </label>
                </div>
            </div>

            <div class="analysis-panel">
                <h3>Limiter</h3>
                <p class="description">Set the final ceiling for the processed audio.</p>
                <div class="limiter-controls">
                    <div class="control-group">
                        <label>Ceiling (dBFS)</label>
                        <input type="range" id="limiter-ceiling" min="-12" max="0" value="-0.1" step="0.1">
                        <span id="limiter-ceiling-value">-0.1 dBFS</span>
                    </div>
                </div>
            </div>
            
            <!-- Global Process Audio Button -->
            <div class="analysis-panel">
                <h3>Process Audio</h3>
                <p class="description">Apply all enabled effects to the selected track</p>
                <button class="btn btn-success btn-large" id="processAudioBtn" disabled>üéöÔ∏è Process Audio</button>
            </div>
        </div>

        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
            <p>Processing audio...</p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
